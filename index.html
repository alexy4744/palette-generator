<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Palette Generator</title>
    <link rel="stylesheet" href="normalize.css" type="text/css" />
    <link rel="stylesheet" href="main.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="spectrum.css" />
    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-3.3.1.js"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.js"></script>
    <script>
      $(function() {
        const swatches = $(".swatches");
        const MAX_PICKERS = 25;
        const SPACING = 100;

        let currentTotalPickers = 5;

        addRows(currentTotalPickers);

        for (let i = 0; i < currentTotalPickers; i++) {
          addPicker(i);
        }

        function addPicker(rowNumber, initialColor) {
          const thisPicker = $("<input class='color-picker'/>");
          const row = $(".swatches-row-" + (rowNumber + 1));
          if (!row) return;

          thisPicker
            .appendTo(row)
            .spectrum({
              color: initialColor || "#5089DB"
            })
            .on("dragstop.spectrum", function(event, color) {
              addSwatch(row, color.toHexString());
            });

          return thisPicker;
        }

        function addSwatch(row, hex) {
          console.log(row);
          return $("<div class='swatch'/>")
            .css("background", hex)
            .appendTo(row);
        }

        function addRows(amount = 1, childrens = []) {
          const rows = [];

          for (let i = 0; i < amount; i++) {
            const currentTotal = $(".swatches").children().length;

            if (currentTotal >= MAX_PICKERS) return null;

            const rowNumber = currentTotal + 1;
            const row = $("<div class='swatches-row-" + rowNumber + "'/>");

            childrens.forEach(children => children.appendTo(row));
            row
              .css("width", "calc(" + SPACING + "% / " + currentTotalPickers + ")")
              .appendTo(swatches);

            rows.push(row);
          }

          return rows;
        }
      });
    </script>
  </head>

  <body>
    <div class="swatches"></div>
  </body>
</html>
